import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.7b60570d.js";const p="/portal/images/linux/nginx-location.png",e="/portal/images/linux/cachecontrol.png",u=JSON.parse('{"title":"nginx çŸ¥è¯†æ•´ç†","description":"","frontmatter":{},"headers":[],"relativePath":"workflow/devops/nginx.md","lastUpdated":1705323905000}'),o={name:"workflow/devops/nginx.md"},t=l(`<h1 id="nginx-çŸ¥è¯†æ•´ç†" tabindex="-1">nginx çŸ¥è¯†æ•´ç† <a class="header-anchor" href="#nginx-çŸ¥è¯†æ•´ç†" aria-label="Permalink to &quot;nginx çŸ¥è¯†æ•´ç†&quot;">â€‹</a></h1><blockquote><p>å­¦ä¹ æŒæ¡å¥½ <code>nginx</code></p></blockquote><h2 id="ä¸€ã€åˆè¯†-nginx" tabindex="-1">ä¸€ã€åˆè¯† nginx <a class="header-anchor" href="#ä¸€ã€åˆè¯†-nginx" aria-label="Permalink to &quot;ä¸€ã€åˆè¯† nginx&quot;">â€‹</a></h2><h3 id="_1-1ã€å®‰è£…" tabindex="-1">1.1ã€å®‰è£… <a class="header-anchor" href="#_1-1ã€å®‰è£…" aria-label="Permalink to &quot;1.1ã€å®‰è£…&quot;">â€‹</a></h3><p>ä»¥ centos ä¸ºä¾‹ï¼Œé€šè¿‡ yum è¿›è¡Œå®‰è£…</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># å®‰è£…nginx</span></span>
<span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-y</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># æŸ¥çœ‹å®‰è£…çš„ç‰ˆæœ¬</span></span>
<span class="line"><span style="color:#FFCB6B;">nginx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-v</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># æŸ¥çœ‹ç¼–è¯‘æ—¶çš„å‚æ•°</span></span>
<span class="line"><span style="color:#FFCB6B;">nginx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-V</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_1-2ã€æ“ä½œ" tabindex="-1">1.2ã€æ“ä½œ <a class="header-anchor" href="#_1-2ã€æ“ä½œ" aria-label="Permalink to &quot;1.2ã€æ“ä½œ&quot;">â€‹</a></h3><p><strong>å‘½ä»¤</strong></p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">option</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx.server</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>option</strong></p><ul><li><code>start</code>: å¯åŠ¨</li><li><code>stop</code>: åœæ­¢</li><li><code>status</code>: çŠ¶æ€</li><li><code>restart</code>: é‡å¯</li><li><code>reload</code>: é‡æ–°è¯»å–é…ç½®</li></ul><h3 id="_1-3ã€é…ç½®æ–‡ä»¶" tabindex="-1">1.3ã€é…ç½®æ–‡ä»¶ <a class="header-anchor" href="#_1-3ã€é…ç½®æ–‡ä»¶" aria-label="Permalink to &quot;1.3ã€é…ç½®æ–‡ä»¶&quot;">â€‹</a></h3><p>ä¸Šé¢å®‰è£…çš„ nginx ç‰ˆæœ¬ä¸º <code>nginx/1.20.1</code>ï¼Œä»¥æ­¤ä¸ºä¾‹ï¼Œnginx é…ç½®æ–‡ä»¶å¦‚ä¸‹</p><ul><li><p><code>/etc/nginx/nginx.conf</code>: ä¸»é…ç½®æ–‡ä»¶</p></li><li><p><code>/etc/nginx/conf.d/*.conf</code>: åŒ…å«<code>conf.d</code>ç›®å½•ä¸‹é¢çš„æ‰€æœ‰é…ç½®æ–‡ä»¶</p></li><li><p><code>/etc/nginx/default.d/*.conf</code>: åŒ…å«<code>default.d</code>ç›®å½•ä¸‹é¢çš„æ‰€æœ‰é…ç½®æ–‡ä»¶</p></li></ul><p><strong><code>nginx</code>é…ç½®è¯­æ³•</strong></p><p>ä¸»é…ç½®æ–‡ä»¶ <code>/etc/nginx/nginx.conf</code> é…ç½®å¦‚ä¸‹</p><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># å…¨å±€é…ç½®</span></span>
<span class="line"><span style="color:#89DDFF;">user </span><span style="color:#A6ACCD;">nginx</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># user: è®¾ç½®nginxæœåŠ¡çš„ç³»ç»Ÿä½¿ç”¨ç”¨æˆ·</span></span>
<span class="line"><span style="color:#89DDFF;">worker_processes </span><span style="color:#A6ACCD;">auto</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># å·¥ä½œè¿›ç¨‹æ•°,ä¸€èˆ¬å’ŒCPUæ•°é‡ç›¸åŒ</span></span>
<span class="line"><span style="color:#89DDFF;">error_log </span><span style="color:#A6ACCD;">/var/log/nginx/error.log</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># nginxçš„é”™è¯¯æ—¥å¿—</span></span>
<span class="line"><span style="color:#89DDFF;">pid </span><span style="color:#A6ACCD;">/run/nginx.pid</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># nginxæœåŠ¡å¯åŠ¨æ—¶çš„pid</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.</span></span>
<span class="line"><span style="color:#89DDFF;">include </span><span style="color:#A6ACCD;">/usr/share/nginx/modules/*.conf</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># äº‹ä»¶é…ç½®</span></span>
<span class="line"><span style="color:#C792EA;">events</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> worker_connections </span><span style="color:#A6ACCD;">1024</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># æ¯ä¸ªè¿›ç¨‹å…è®¸çš„æœ€å¤§è¿æ¥æ•°</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># http é…ç½®</span></span>
<span class="line"><span style="color:#C792EA;">http</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> log_format  main</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">&#39;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">remote_addr</span><span style="color:#C3E88D;"> - </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">remote_user</span><span style="color:#C3E88D;"> [</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">time_local</span><span style="color:#C3E88D;">] &quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">request</span><span style="color:#C3E88D;">&quot; &#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">                      </span><span style="color:#C3E88D;">&#39;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">status</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">body_bytes_sent</span><span style="color:#C3E88D;"> &quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_referer</span><span style="color:#C3E88D;">&quot; &#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">                      </span><span style="color:#C3E88D;">&#39;&quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_user_agent</span><span style="color:#C3E88D;">&quot; &quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_x_forwarded_for</span><span style="color:#C3E88D;">&quot;&#39;</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># æ—¥å¿—è®°å½•æ ¼å¼</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> access_log </span><span style="color:#A6ACCD;"> /var/log/nginx/access.log </span><span style="color:#89DDFF;"> main;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># é»˜è®¤è®¿é—®æ—¥å¿—</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> sendfile </span><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;"> on;</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># å¯åŠ¨ sendfile</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> tcp_nopush </span><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;"> on;</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># tcp_nopush: æ‡’å‘é€</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> tcp_nodelay </span><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> on;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> keepalive_timeout </span><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">65</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># è¶…æ—¶æ—¶é—´</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> types_hash_max_size </span><span style="color:#A6ACCD;">4096</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> include </span><span style="color:#A6ACCD;">            /etc/nginx/mime.types</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># æ–‡ä»¶åç¼€å’Œç±»å‹ç±»å‹çš„å¯¹åº”å…³ç³»</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> default_type </span><span style="color:#A6ACCD;">       application/octet-stream</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># é»˜è®¤content-type</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> include </span><span style="color:#A6ACCD;">/etc/nginx/conf.d/*.conf</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># åŒ…å«çš„å­é…ç½®æ–‡ä»¶</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># server é…ç½®</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">80</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># ç›‘å¬ç«¯å£</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">      [::]:80</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;"> _</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># ç”¨åŸŸåæ–¹å¼è®¿é—®çš„åœ°å€</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">        /usr/share/nginx/html</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># é™æ€æ–‡ä»¶æ ¹ç›®å½•</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">         </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">/usr/share/nginx/html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">         </span><span style="color:#89DDFF;"> index </span><span style="color:#A6ACCD;">index.html index.htm</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># é¦–é¡µçš„ç´¢å¼•æ–‡ä»¶</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> error_page </span><span style="color:#A6ACCD;">404 /404.html</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># æŒ‡å®šé”™è¯¯é¡µé¢ ğŸ™…â€â™‚ï¸</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/404.html </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> error_page </span><span style="color:#A6ACCD;">500 </span><span style="color:#F78C6C;">502</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">503</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">504</span><span style="color:#A6ACCD;"> /50x.html</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># æŠŠåå°é”™è¯¯é‡å®šå‘åˆ°é™æ€çš„50x.htmlé¡µé¢</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/50x.html </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><ul><li>é…ç½®æ–‡ä»¶ç”± <strong>æŒ‡ä»¤</strong> ä¸ <strong>æŒ‡ä»¤å—</strong> ç»„æˆ,æŒ‡ä»¤å—ä»¥<code>{}</code>å°†å¤šæ¡æŒ‡ä»¤ç»„ç»‡åœ¨ä¸€èµ·</li><li>æ¯æ¡æŒ‡ä»¤ä»¥ <strong><code>;</code>(åˆ†å·)</strong> ç»“å°¾ï¼ŒæŒ‡ä»¤ä¸å‚æ•°ä¹‹é—´ä»¥ç©ºæ ¼åˆ†éš”</li><li><code>include</code> è¯­å¥å…è®¸æŠŠå¤šä¸ªé…ç½®æ–‡ä»¶ç»„åˆèµ·æ¥ä»¥æå‡å¯ç»´æŠ¤æ€§</li><li>ä¸€ä¸ª<code>http</code>ä¸‹é¢å¯ä»¥é…ç½®å¤šä¸ª <code>server</code>, ä¸€ä¸ª <code>server</code> ä¸‹é¢å¯ä»¥é…ç½®å¤šä¸ª <code>location</code></li></ul><h2 id="äºŒã€nginx-å·¥ä½œæµ" tabindex="-1">äºŒã€nginx å·¥ä½œæµ <a class="header-anchor" href="#äºŒã€nginx-å·¥ä½œæµ" aria-label="Permalink to &quot;äºŒã€nginx å·¥ä½œæµ&quot;">â€‹</a></h2><h2 id="ä¸‰ã€nginx-è¯­æ³•" tabindex="-1">ä¸‰ã€nginx è¯­æ³• <a class="header-anchor" href="#ä¸‰ã€nginx-è¯­æ³•" aria-label="Permalink to &quot;ä¸‰ã€nginx è¯­æ³•&quot;">â€‹</a></h2><h3 id="_3-1ã€location" tabindex="-1">3.1ã€location <a class="header-anchor" href="#_3-1ã€location" aria-label="Permalink to &quot;3.1ã€location&quot;">â€‹</a></h3><p><code>location</code> ä¼šç”¨æ¥åŒ¹é… <code>URI</code>ï¼Œä½†ä¼šå¿½ç•¥å…¶ä¸­çš„å‚æ•°</p><p><strong>æ­£åˆ™è¡¨è¾¾å¼</strong></p><table><thead><tr><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>.</code></td><td>åŒ¹é…é™¤æ¢è¡Œç¬¦ä¹‹å¤–çš„ä»»æ„å­—ç¬¦</td></tr><tr><td><code>?</code></td><td>é‡å¤ 0 æ¬¡æˆ– 1 æ¬¡</td></tr><tr><td><code>+</code></td><td>é‡å¤ 1 æ¬¡æˆ–æ›´å¤šæ¬¡</td></tr><tr><td><code>*</code></td><td>é‡å¤ 0 æ¬¡æˆ–å¤šæ¬¡</td></tr><tr><td><code>^</code></td><td>åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹</td></tr><tr><td><code>$</code></td><td>åŒ¹é…å­—ç¬¦ä¸²çš„ç»“æŸ</td></tr><tr><td><code>{n}</code></td><td>é‡å¤ n æ¬¡</td></tr><tr><td><code>{n,}</code></td><td>é‡å¤ n æ¬¡æˆ–æ›´å¤šæ¬¡</td></tr><tr><td><code>[abc]</code></td><td>åŒ¹é…å•ä¸ªå­—ç¬¦ a æˆ–è€… b æˆ–è€… c</td></tr><tr><td><code>a-z</code></td><td>åŒ¹é… a-z å°å†™å­—æ¯çš„ä»»æ„ä¸€ä¸ª</td></tr><tr><td><code>\\</code></td><td>è½¬ä¹‰å­—ç¬¦</td></tr><tr><td><code>()</code></td><td>åˆ†ç»„ï¼Œç”¨äºåŒ¹é…æ‹¬å·ä¹‹é—´çš„å†…å®¹ï¼Œå¯ä»¥é€šè¿‡$1ã€$2 å¼•ç”¨</td></tr><tr><td><code>\\w</code></td><td>æŒ‡åŒ…å«å¤§ å°å†™å­—æ¯æ•°å­—å’Œä¸‹åˆ’çº¿ ç›¸å½“äº(<code>[0-9a-zA-Z]</code>)</td></tr></tbody></table><p><strong>è¯­æ³•è§„åˆ™</strong></p><ul><li>å‰ç¼€åŒ¹é… <ul><li>å¸¸è§„</li><li><code>=</code>, ç²¾ç¡®åŒ¹é…</li><li><code>^~</code>, åŒ¹é…ä¸Šååˆ™ä¸å†ç»§ç»­è¿›è¡Œæ­£åˆ™çš„åŒ¹é…</li></ul></li><li>æ­£åˆ™è¡¨è¾¾å¼ <ul><li><code>~</code>, å¤§å°å†™æ•æ„Ÿçš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</li><li><code>~*</code>, å¿½ç•¥å¤§å°å†™æ•æ„Ÿçš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</li></ul></li><li>å†…éƒ¨è°ƒè½¬ <ul><li>ç”¨äºå†…éƒ¨è·³è½¬çš„å‘½å <code>location @xxx</code></li></ul></li></ul><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">[=|~|~*|^~] uri </span><span style="color:#A6ACCD;">{...}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">@name</span><span style="color:#A6ACCD;">{...}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>åŒ¹é…è§„åˆ™</strong><img src="`+p+`" alt=""></p><ul><li>ç­‰å·ç±»å‹ï¼ˆ=ï¼‰çš„ä¼˜å…ˆçº§æœ€é«˜</li><li>^~ç±»å‹è¡¨è¾¾å¼çš„ä¼˜å…ˆçº§æ¬¡ä¹‹</li><li>åä¹‹ï¼Œåˆ™åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ç±»å‹ï¼ˆ~ ~*ï¼‰ï¼Œå¦‚æœæœ‰å¤šä¸ª location çš„æ­£åˆ™èƒ½åŒ¹é…çš„è¯ï¼Œåˆ™ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æœ€é•¿çš„é‚£ä¸ª</li><li>æœ€åï¼Œå¸¸è§„å­—ç¬¦ä¸²åŒ¹é…ç±»å‹æŒ‰å‰ç¼€åŒ¹é…</li></ul><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">location ~ /T1/$ {</span></span>
<span class="line"><span style="color:#A6ACCD;">  return 200 &#39;åŒ¹é…åˆ°ç¬¬ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼&#39;;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">location ~* /T1/(\\w+)$ {</span></span>
<span class="line"><span style="color:#A6ACCD;">  return 200 &#39;åŒ¹é…åˆ°æœ€é•¿çš„æ­£åˆ™è¡¨è¾¾å¼&#39;;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">location ^~ /T1/ {</span></span>
<span class="line"><span style="color:#A6ACCD;">  return 200 &#39;åœæ­¢åç»­çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…&#39;;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">location  /T1/T2 {</span></span>
<span class="line"><span style="color:#A6ACCD;">  return 200 &#39;æœ€é•¿çš„å‰ç¼€è¡¨è¾¾å¼åŒ¹é…&#39;;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">location  /T1 {</span></span>
<span class="line"><span style="color:#A6ACCD;">  return 200 &#39;å‰ç¼€è¡¨è¾¾å¼åŒ¹é…&#39;;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">location = /T1 {</span></span>
<span class="line"><span style="color:#A6ACCD;">  return 200 &#39;ç²¾ç¡®åŒ¹é…&#39;;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">/T1     //ç²¾ç¡®åŒ¹é…</span></span>
<span class="line"><span style="color:#A6ACCD;">/T1/    //åœæ­¢åç»­çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</span></span>
<span class="line"><span style="color:#A6ACCD;">/T1/T2  //åŒ¹é…åˆ°æœ€é•¿çš„æ­£åˆ™è¡¨è¾¾å¼</span></span>
<span class="line"><span style="color:#A6ACCD;">/T1/T2/ //æœ€é•¿çš„å‰ç¼€è¡¨è¾¾å¼åŒ¹é…</span></span>
<span class="line"><span style="color:#A6ACCD;">/t1/T2  //åŒ¹é…åˆ°æœ€é•¿çš„æ­£åˆ™è¡¨è¾¾å¼</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_3-2ã€rewrite" tabindex="-1">3.2ã€rewrite <a class="header-anchor" href="#_3-2ã€rewrite" aria-label="Permalink to &quot;3.2ã€rewrite&quot;">â€‹</a></h3><p>é€šè¿‡ <code>rewrite</code> å®ç° url é‡å†™åŠé‡å®šå‘</p><p><strong>è¯­æ³•</strong></p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">rewrite regex replacement [flag]</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>flag</strong></p><p>flag: æ ‡è¯†è§„åˆ™å¯¹åº”çš„ç±»å‹</p><table><thead><tr><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>last</code></td><td>å…ˆåŒ¹é…è‡ªå·±çš„ location,ç„¶åé€šè¿‡<code>rewrite</code>è§„åˆ™æ–°å»ºä¸€ä¸ªè¯·æ±‚å†æ¬¡è¯·æ±‚æœåŠ¡ç«¯</td></tr><tr><td><code>break</code></td><td>å…ˆåŒ¹é…è‡ªå·±çš„ location,ç„¶åç”Ÿå‘½å‘¨æœŸä¼šåœ¨å½“å‰çš„ location ç»“æŸ,ä¸å†è¿›è¡Œåç»­çš„åŒ¹é…</td></tr><tr><td><code>redirect</code></td><td>è¿”å› 302 æ˜¨æ—¶é‡å®šå‘,ä»¥åè¿˜ä¼šè¯·æ±‚è¿™ä¸ªæœåŠ¡å™¨</td></tr><tr><td><code>permanent</code></td><td>è¿”å› 301 æ°¸ä¹…é‡å®šå‘,ä»¥åä¼šç›´æ¥è¯·æ±‚æ°¸ä¹…é‡å®šå‘åçš„åŸŸå</td></tr></tbody></table><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">^/break </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">rewrite</span><span style="color:#A6ACCD;"> ^/break /test </span><span style="color:#F78C6C;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">/data/html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">^/last </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">rewrite</span><span style="color:#A6ACCD;"> ^/last /test</span><span style="color:#89DDFF;"> last;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/test </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> default_type </span><span style="color:#A6ACCD;">application/json</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&#39;{&quot;code&quot;:0,&quot;msg&quot;:&quot;success&quot;}&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">^/redirect </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">rewrite</span><span style="color:#A6ACCD;"> ^/redirect http://www.baidu.com </span><span style="color:#F78C6C;">redirect</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">^/permanent </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">rewrite</span><span style="color:#A6ACCD;"> ^/permanent http://www.baidu.com </span><span style="color:#F78C6C;">permanent</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># curl http://localhost/last</span></span>
<span class="line"><span style="color:#89DDFF;">{</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">code</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">msg</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">success</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># curl http://localhost/break</span></span>
<span class="line"><span style="color:#82AAFF;">test</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># å¹¶æ²¡æœ‰ç»§ç»­åŒ¹é…åˆ° \`/test\`, è€Œæ˜¯ç›´æ¥ç»ˆæ­¢ï¼Œå» /data/html/ ç›®å½•ä¸‹å»åŒ¹é… test ç›®å½•</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># curl -vL http://localhost/redirect</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># curl -vL http://localhost/permanent</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="å››ã€nginx-å®æˆ˜" tabindex="-1">å››ã€nginx å®æˆ˜ <a class="header-anchor" href="#å››ã€nginx-å®æˆ˜" aria-label="Permalink to &quot;å››ã€nginx å®æˆ˜&quot;">â€‹</a></h2><h3 id="_4-1ã€é™æ€èµ„æº-web-æœåŠ¡" tabindex="-1">4.1ã€é™æ€èµ„æº web æœåŠ¡ <a class="header-anchor" href="#_4-1ã€é™æ€èµ„æº-web-æœåŠ¡" aria-label="Permalink to &quot;4.1ã€é™æ€èµ„æº web æœåŠ¡&quot;">â€‹</a></h3><p><strong>é™æ€èµ„æº</strong>: ä¸€èˆ¬å®¢æˆ·ç«¯å‘é€è¯·æ±‚åˆ° web æœåŠ¡å™¨ï¼Œweb æœåŠ¡å™¨ä»<strong>å†…å­˜</strong>ä¸­å–åˆ°ç›¸åº”çš„æ–‡ä»¶ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯è§£æå¹¶æ¸²æŸ“æ˜¾ç¤ºå‡ºæ¥</p><p><strong>CDN</strong>: å®æ—¶åœ°æ ¹æ®ç½‘ç»œæµé‡å’Œå„èŠ‚ç‚¹çš„è¿æ¥ã€è´Ÿè½½çŠ¶å†µä»¥åŠåˆ°ç”¨æˆ·çš„è·ç¦»å’Œå“åº”æ—¶é—´ç­‰ç»¼åˆä¿¡æ¯å°†ç”¨æˆ·çš„è¯·æ±‚é‡æ–°å¯¼å‘ç¦»ç”¨æˆ·æœ€è¿‘çš„æœåŠ¡èŠ‚ç‚¹ä¸Š</p><p><strong>é…ç½®é€‰é¡¹</strong></p><table><thead><tr><th>é…ç½®é¡¹</th><th>å«ä¹‰</th><th>å¯é€‰å€¼</th><th>é»˜è®¤å€¼</th><th>ä¸Šä¸‹æ–‡</th></tr></thead><tbody><tr><td><strong><code>sendfile</code></strong></td><td>ä¸ç»è¿‡ç”¨æˆ·å†…æ ¸å‘é€æ–‡ä»¶</td><td>on/off</td><td>off</td><td><code>http, server, location, </code></td></tr><tr><td><strong><code>tcp_nopush</code></strong></td><td>åœ¨<code>sendfile</code>å¼€å¯çš„æƒ…å†µä¸‹ï¼Œåˆå¹¶å¤šä¸ªæ•°æ®åŒ…ï¼Œæé«˜ç½‘ç»œåŒ…çš„ä¼ è¾“æ•ˆç‡</td><td>on/off</td><td>off</td><td><code>http, server, location, </code></td></tr><tr><td><strong><code>tcp_nodelay</code></strong></td><td>åœ¨<code>keepalive</code>è¿æ¥ä¸‹ï¼Œæé«˜ç½‘ç»œåŒ…çš„ä¼ è¾“å®æ—¶æ€§</td><td>on/off</td><td>off</td><td><code>http, server, location, </code></td></tr><tr><td><strong><code>gzip</code></strong></td><td>å‹ç¼©æ–‡ä»¶å¯ä»¥èŠ‚çº¦å¸¦å®½å’Œæé«˜ç½‘ç»œä¼ è¾“æ•ˆç‡ç±»å‹</td><td>on/off</td><td>off</td><td><code>http, server, location, </code></td></tr><tr><td><strong><code>gzip_min_length</code></strong></td><td>æœ€å°å‹ç¼©æ–‡ä»¶çš„å¤§å°</td><td>size</td><td></td><td><code>http, server, location, </code></td></tr><tr><td><strong><code>gzip_comp_level</code></strong></td><td>å‹ç¼©çº§åˆ«, å€¼è¶Šé«˜ï¼Œå‹ç¼©çš„ä½“ç§¯è¶Šå°</td><td>level</td><td>1</td><td><code>http, server, location, </code></td></tr><tr><td><strong><code>gzip_http_version</code></strong></td><td>å‹ç¼©ç‰ˆæœ¬</td><td>1.0/1.1</td><td>1.1</td><td><code>http, server, location, </code></td></tr><tr><td><strong><code>http_gzip-static_module</code></strong></td><td>å…ˆæ‰¾ç£ç›˜ä¸Šæ‰¾åŒåçš„<code>.gz</code>è¿™ä¸ªæ–‡ä»¶æ˜¯å¦å­˜åœ¨,èŠ‚çº¦ CPU çš„å‹ç¼©æ—¶é—´å’Œæ€§èƒ½æŸè€—</td><td>on/off</td><td>off</td><td><code>http, server, location, </code></td></tr></tbody></table><p><strong>å®æˆ˜</strong></p><ul><li>èµ„æº</li></ul><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/data/www/images</span></span>
<span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/data/www/html</span></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">color</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/data/www/html/color.html</span></span>
<span class="line"><span style="color:#FFCB6B;">gzip</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/data/www/html/color.html</span></span>
<span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/data/www/download</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>é…ç½®</li></ul><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.*\\.(jpg|png|gif)$ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> gzip </span><span style="color:#A6ACCD;">off</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">#å…³é—­å‹ç¼©</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">/data/www/images</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.*\\.(html|js|css)$ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> gzip_static </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> gzip </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">#å¯ç”¨å‹ç¼©</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> gzip_min_length </span><span style="color:#A6ACCD;">1k</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">#åªå‹ç¼©è¶…è¿‡1Kçš„æ–‡ä»¶</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> gzip_http_version </span><span style="color:#A6ACCD;">1.1</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">#å¯ç”¨gzipå‹ç¼©æ‰€éœ€çš„HTTPæœ€ä½ç‰ˆæœ¬</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> gzip_comp_level </span><span style="color:#A6ACCD;">9</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">     </span><span style="color:#676E95;font-style:italic;">#å‹ç¼©çº§åˆ«ï¼Œå‹ç¼©æ¯”ç‡è¶Šé«˜æ–‡ä»¶è¢«å‹ç¼©çš„ä½“ç§¯è¶Šå°</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> gzip_types </span><span style="color:#A6ACCD;"> text/css application/javascript</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">#è¿›è¡Œå‹ç¼©çš„æ–‡ä»¶ç±»å‹</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">/data/www/html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">^/download </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> gzip_static </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">#å¯ç”¨å‹ç¼©</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> tcp_nopush </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># ä¸è¦ç€æ€¥å‘ï¼Œæ”’ä¸€æ³¢å†å‘</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">/data/www</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># æ³¨æ„æ­¤å¤„ç›®å½•æ˜¯\`/data/www\`è€Œä¸æ˜¯\`/data/www/download\`</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="_4-2ã€æµè§ˆå™¨ç¼“å­˜" tabindex="-1">4.2ã€æµè§ˆå™¨ç¼“å­˜ <a class="header-anchor" href="#_4-2ã€æµè§ˆå™¨ç¼“å­˜" aria-label="Permalink to &quot;4.2ã€æµè§ˆå™¨ç¼“å­˜&quot;">â€‹</a></h3><p><strong>æµè§ˆå™¨æ ¡éªŒæœ¬åœ°ç¼“å­˜æµç¨‹</strong></p><p><img src="`+e+`" alt=""></p><p>å¯è®¾ç½®çš„å“åº”å¤´</p><ul><li>Expires</li><li>Cache-Control</li><li>Etag</li><li>Last-Modified</li></ul><p><strong>è®¾ç½® Expires</strong></p><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.*\\.(jpg|png|gif)$ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> expires </span><span style="color:#A6ACCD;">24h</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_4-3ã€è·¨åŸŸ" tabindex="-1">4.3ã€è·¨åŸŸ <a class="header-anchor" href="#_4-3ã€è·¨åŸŸ" aria-label="Permalink to &quot;4.3ã€è·¨åŸŸ&quot;">â€‹</a></h3><p>å…³äºä»€ä¹ˆæ˜¯è·¨åŸŸï¼Œä»¥åŠæ±‡æ€»çš„è§£å†³åŠæ³•ï¼Œè¯·å‚è€ƒ <a href="https://yangjia23.github.io/portal-blog/frontend-graph/%E6%B5%8F%E8%A7%88%E5%99%A8/4%E3%80%81%E4%B8%80%E6%96%87%E6%B1%87%E6%80%BB9%E7%A7%8D%E8%B7%A8%E5%9F%9F%E6%96%B9%E6%B3%95.html" target="_blank" rel="noreferrer">ä¸€æ–‡æ±‡æ€» 9 ç§è·¨åŸŸæ–¹æ³•</a>ï¼Œåœ¨ nginx ä¸­è§£å†³è·¨åŸŸï¼Œéœ€è¦è®¾ç½®ä¸åŒçš„å“åº”å¤´</p><p><strong>è¯­æ³•</strong></p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">add_header</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">name</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">value</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>å®¢æˆ·ç«¯</strong></p><p>åœ¨å®¢æˆ·ç«¯é€šè¿‡ live-server å¼€å¯æœ¬åœ°æœåŠ¡ï¼Œå‘æœåŠ¡ç«¯å‘é€è¯·æ±‚</p><div class="language-html line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;!</span><span style="color:#F07178;">DOCTYPE</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">html</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">PUBLIC</span><span style="color:#89DDFF;"> </span><span style="color:#C3E88D;">&quot;-//W3C//DTD HTML 4.0 Transitional//EN&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">    &lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> xhr </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">XMLHttpRequest</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">      xhr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">open</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GET</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">http://{ip}/user.json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">      xhr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onreadystatechange</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">xhr</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">readyState</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">4</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">xhr</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">200</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">xhr</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">responseText</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">      xhr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>æœåŠ¡ç«¯</strong></p><ul><li>é™æ€èµ„æº</li></ul><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/data/json</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/data/json</span></span>
<span class="line"><span style="color:#FFCB6B;">vi</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">user.json</span></span>
<span class="line"><span style="color:#89DDFF;">{</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">å‰ç«¯å£¹ç”²å£¹</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>nginx é…ç½®</li></ul><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.*\\.json$ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> add_header </span><span style="color:#A6ACCD;">Access-Control-Allow-Origin http://127.0.0.1:8080</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> add_header </span><span style="color:#A6ACCD;">Access-Control-Allow-Methods GET,POST,PUT,DELETE,OPTIONS</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">/data/json</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_4-4ã€ä»£ç†" tabindex="-1">4.4ã€ä»£ç† <a class="header-anchor" href="#_4-4ã€ä»£ç†" aria-label="Permalink to &quot;4.4ã€ä»£ç†&quot;">â€‹</a></h3><p>é€šè¿‡åœ¨ <code>server</code> æˆ– <code>location</code> ä¸­è®¾ç½® <code>proxy_pass</code> æ¥å®ç°ä»£ç†</p><h4 id="_4-4-1ã€æ­£å‘ä»£ç†" tabindex="-1">4.4.1ã€æ­£å‘ä»£ç† <a class="header-anchor" href="#_4-4-1ã€æ­£å‘ä»£ç†" aria-label="Permalink to &quot;4.4.1ã€æ­£å‘ä»£ç†&quot;">â€‹</a></h4><p>æ­£å‘ä»£ç†çš„å¯¹è±¡æ˜¯å®¢æˆ·ç«¯,æœåŠ¡å™¨ç«¯çœ‹ä¸åˆ°çœŸæ­£çš„å®¢æˆ·ç«¯ï¼Œä¾‹å¦‚ç¿»å¢™ä½¿ç”¨çš„ VPN</p><h4 id="_4-4-2ã€åå‘ä»£ç†" tabindex="-1">4.4.2ã€åå‘ä»£ç† <a class="header-anchor" href="#_4-4-2ã€åå‘ä»£ç†" aria-label="Permalink to &quot;4.4.2ã€åå‘ä»£ç†&quot;">â€‹</a></h4><p>åå‘ä»£ç†çš„å¯¹è±¡çš„æœåŠ¡ç«¯,å®¢æˆ·ç«¯çœ‹ä¸åˆ°çœŸæ­£çš„æœåŠ¡ç«¯ï¼Œä¾‹å¦‚ nginx ä»£ç†çš„åº”ç”¨æœåŠ¡å™¨</p><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">^/api </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">http://localhost:3000</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_redirect </span><span style="color:#A6ACCD;">default</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">#é‡å®šå‘</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">Host </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_host</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">#å‘åä¼ é€’å¤´ä¿¡æ¯</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">X-Real-IP </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">remote_addr</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">#æŠŠçœŸå®IPä¼ ç»™åº”ç”¨æœåŠ¡å™¨</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_connect_timeout </span><span style="color:#A6ACCD;">30</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">#é»˜è®¤è¶…æ—¶æ—¶é—´</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_send_timeout </span><span style="color:#A6ACCD;">60</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># å‘é€è¶…æ—¶</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_read_timeout </span><span style="color:#A6ACCD;">60</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># è¯»å–è¶…æ—¶</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong><code>proxy_pass</code></strong></p><ul><li><code>proxy_pass</code> åçš„ <code>url</code> æœ€ååŠ ä¸Š <code>/</code> å°±æ˜¯ç»å¯¹æ ¹è·¯å¾„, <code>location</code> ä¸­åŒ¹é…çš„è·¯å¾„éƒ¨åˆ†ä¸èµ°ä»£ç†,ä¹Ÿå°±æ˜¯è¯´ä¼šè¢«æ›¿æ¢æ‰</li></ul><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/a/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">http://127.0.0.1/b/</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># è¯·æ±‚ http://example.com/a/test.html, ä¼šè¢«ä»£ç†åˆ° http://127.0.0.1/b/test.html</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>proxy_pass</code> åçš„ <code>url</code> æœ€åæ²¡æœ‰ <code>/</code> å°±æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œ<code>location</code> ä¸­åŒ¹é…çš„è·¯å¾„éƒ¨åˆ†ä¼šèµ°ä»£ç†,ä¹Ÿå°±æ˜¯è¯´ä¼šä¿ç•™</li></ul><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/a/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">http://127.0.0.1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># è¯·æ±‚ http://example.com/a/test.html, ä¼šè¢«ä»£ç†åˆ° http://127.0.0.1/a/test.html</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>(PS: ä¸ºäº†æ–¹ä¾¿è®°å¿†å’Œè§„èŒƒé…ç½®ï¼Œå»ºè®®æ‰€æœ‰çš„ <code>proxy_pass</code> åçš„<code>url</code>éƒ½ä»¥<code>/</code>ç»“å°¾ )</p><ul><li>åœ¨<code>proxy_pass</code>å‰é¢ç”¨äº†<code>rewrite</code>ï¼Œå¦‚ä¸‹ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œ<code>proxy_pass</code>æ˜¯æ— æ•ˆçš„</li></ul><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/getName/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">rewrite</span><span style="color:#A6ACCD;">    /getName/([</span><span style="color:#C3E88D;">^/]+) /users?name=$</span><span style="color:#A6ACCD;">1 </span><span style="color:#F78C6C;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">http://127.0.0.1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_4-5ã€è´Ÿè½½å‡è¡¡" tabindex="-1">4.5ã€è´Ÿè½½å‡è¡¡ <a class="header-anchor" href="#_4-5ã€è´Ÿè½½å‡è¡¡" aria-label="Permalink to &quot;4.5ã€è´Ÿè½½å‡è¡¡&quot;">â€‹</a></h3><p>å½“ç½‘ç«™å‡ºè¡Œé«˜å¹¶å‘ï¼Œè®¿é—®é‡å¤§æ—¶ï¼Œä¸€å°æœåŠ¡å™¨çš„å¤„ç†èƒ½åŠ›ã€å­˜å‚¨ç©ºé—´ä¸è¶³æ—¶ï¼Œåº”è¯¥å¢åŠ ä¸€å°æœåŠ¡å™¨å»åˆ†æ‹…ç½‘ç«™çš„è®¿é—®åŠå­˜å‚¨å‹åŠ›ã€‚</p><p>é€šè¿‡è´Ÿè½½å‡è¡¡è°ƒåº¦æœåŠ¡å™¨ï¼Œå°†æ‰€æœ‰çš„è®¿é—®è¯·æ±‚åˆ†å‘åˆ°åº”ç”¨æœåŠ¡å™¨é›†ç¾¤ä¸­çš„ä»»ä½•ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œå½“æœ‰æ›´å¤šçš„è®¿é—®ï¼Œå°±åœ¨é›†ç¾¤ä¸­åŠ å…¥æ›´å¤šçš„åº”ç”¨æœåŠ¡å™¨</p><h4 id="_4-5-1ã€upstream" tabindex="-1">4.5.1ã€upstream <a class="header-anchor" href="#_4-5-1ã€upstream" aria-label="Permalink to &quot;4.5.1ã€upstream&quot;">â€‹</a></h4><p>é€šè¿‡ <code>upstream</code> å®šä¹‰ä¸€ç»„æœåŠ¡æ± ï¼Œnginx æŠŠè¯·æ±‚è½¬å‘åˆ°æœåŠ¡æ± </p><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">webServer </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 127.0.0.1:3000;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 127.0.0.1:4000;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 127.0.0.1:5000;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_4-5-2ã€åç«¯æœåŠ¡å™¨è°ƒè¯•çŠ¶æ€" tabindex="-1">4.5.2ã€åç«¯æœåŠ¡å™¨è°ƒè¯•çŠ¶æ€ <a class="header-anchor" href="#_4-5-2ã€åç«¯æœåŠ¡å™¨è°ƒè¯•çŠ¶æ€" aria-label="Permalink to &quot;4.5.2ã€åç«¯æœåŠ¡å™¨è°ƒè¯•çŠ¶æ€&quot;">â€‹</a></h4><table><thead><tr><th>çŠ¶æ€</th><th>æè¿°</th></tr></thead><tbody><tr><td><strong><code>down</code></strong></td><td>å½“å‰æœåŠ¡å™¨ä¸å‚ä¸è´Ÿè½½å‡è¡¡</td></tr><tr><td><strong><code>backup</code></strong></td><td>å½“å…¶å®ƒèŠ‚ç‚¹éƒ½æ— æ³•ä½¿ç”¨æ—¶çš„å¤‡ä»½æœåŠ¡å™¨</td></tr><tr><td><strong><code>max_fails</code></strong></td><td>å…è®¸è¯·æ±‚å¤±è´¥çš„æ¬¡æ•°, åˆ°è¾¾æœ€å¤§æ¬¡æ•°å°±ä¼šä¼‘çœ </td></tr><tr><td><strong><code>fail_timeout</code></strong></td><td>ç»è¿‡ max_fails å¤±è´¥åï¼ŒæœåŠ¡å™¨ä¼‘çœ æ—¶é—´,é»˜è®¤ 10 ç§’</td></tr><tr><td><strong><code>max_conns</code></strong></td><td>å½“å‰æœåŠ¡å™¨å¯æ¥æ”¶çš„æœ€å¤§è¿æ¥æ•°</td></tr></tbody></table><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">webServer </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 127.0.0.1:3000 down; </span><span style="color:#676E95;font-style:italic;">#ä¸å‚ä¸è´Ÿè½½å‡è¡¡</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 127.0.0.1:4000 backup; </span><span style="color:#676E95;font-style:italic;">#å……å½“å¤‡ä»½æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 127.0.0.1:5000 ;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_4-5-2ã€åˆ†é…æ–¹å¼" tabindex="-1">4.5.2ã€åˆ†é…æ–¹å¼ <a class="header-anchor" href="#_4-5-2ã€åˆ†é…æ–¹å¼" aria-label="Permalink to &quot;4.5.2ã€åˆ†é…æ–¹å¼&quot;">â€‹</a></h4><table><thead><tr><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>è½®è¯¢(é»˜è®¤)</td><td><strong>å¹³å‡ä¸»ä¹‰</strong>, æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå½“æŸä¸ªæœåŠ¡å™¨ down æ‰ï¼Œä¼šè¢«è‡ªåŠ¨å‰”é™¤</td></tr><tr><td><strong><code>weight</code></strong></td><td><strong>åŠ æƒè½®è¯¢</strong>ï¼Œé€šè¿‡<code>weight</code>æŒ‡å®šè½®è¯¢å‡ ç‡ï¼Œ<code>weight</code>å’Œè®¿é—®æ¯”ç‡æˆæ­£æ¯”</td></tr><tr><td><strong><code>ip_hash</code></strong></td><td>æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®<code>ip</code>çš„<code>hash</code>ç»“æœåˆ†é…, æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³<code>session</code> çš„é—®é¢˜</td></tr><tr><td><strong><code>least_conn</code></strong></td><td>å“ªä¸ªæœºå™¨ä¸Šè¿æ¥æ•°å°‘å°±åˆ†å‘ç»™è°</td></tr><tr><td><strong><code>url_hash</code></strong></td><td>æŒ‰è®¿é—®çš„<code>URL</code>åœ°å€æ¥åˆ†é… è¯·æ±‚ï¼Œæ¯ä¸ª<code>URL</code>éƒ½å®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ä¸Š(ç¼“å­˜)ã€‚(ps: <em>ç¬¬ä¸‰æ–¹</em>ï¼‰</td></tr><tr><td><strong><code>fair</code></strong></td><td>æŒ‰åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚ï¼ˆps: <em>ç¬¬ä¸‰æ–¹</em>ï¼‰</td></tr></tbody></table><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># weight</span></span>
<span class="line"><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">webServer </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 127.0.0.1:3000 </span><span style="color:#A6ACCD;font-style:italic;">weight</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  server 127.0.0.1:4000 </span><span style="color:#A6ACCD;font-style:italic;">weight</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  server 127.0.0.1:5000 </span><span style="color:#A6ACCD;font-style:italic;">weight</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># ip_hash</span></span>
<span class="line"><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">webServer </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">ip_hash</span><span style="color:#A6ACCD;"> # [type], type = ip_hash | least_conn | url_hash | fair</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 127.0.0.1:3000;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div>`,98),r=[t];function c(i,y,C,D,d,A){return n(),a("div",null,r)}const F=s(o,[["render",c]]);export{u as __pageData,F as default};
